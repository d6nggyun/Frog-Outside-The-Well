@Transactional
public TodoStepResponse breakdownTask(Long userId, GeminiReqDto requestDto) {
    try {
        // 1) ìƒˆë¡œìš´ Todo ìƒì„± (title, endDateëŠ” Gemini ì‘ë‹µ ê¸°ë°˜ or íŒŒë¼ë¯¸í„° ê¸°ë°˜ìœ¼ë¡œ ì„¸íŒ…)
        Todo todo = Todo.createTodo(userId, requestDto.getTitle(), requestDto.getEndDate());
        todoRepository.save(todo);

        // 2) Gemini ì‘ë‹µìœ¼ë¡œë¶€í„° step ë¦¬ìŠ¤íŠ¸ ë½‘ì•„ë‚´ê¸°
        List<TodoStep> todoSteps = requestDto.getContents().stream()
                .map(content -> TodoStep.builder()
                        .todoId(todo.getId())  // ğŸ”¥ ì—¬ê¸°ì„œ todo_id ì±„ì›Œì§
                        .userId(userId)
                        .stepDate(LocalDate.now()) // í•„ìš”ì— ë§ê²Œ ì¡°ì • (ì˜ˆ: Geminiì—ì„œ ë°›ì€ ë‚ ì§œ)
                        .description(content.getText()) // Geminiê°€ ë±‰ì€ í…ìŠ¤íŠ¸
                        .isCompleted(false)
                        .build())
                .toList();

        todoStepRepository.saveAll(todoSteps);

        // 3) Step â†’ StepResponse ë³€í™˜
        List<StepResponse> stepResponses = todoSteps.stream()
                .map(step -> StepResponse.from(todo, step))
                .toList();

        // 4) TodoStepResponse ìƒì„±
        String progressText = "ê°œêµ¬ë¦¬ê°€ ì²« ê±¸ìŒì„ ë—ì–´ìš”!"; // í•„ìš” ì‹œ ë™ì  ìƒì„±
        return TodoStepResponse.from(todo, progressText, stepResponses);

    } catch (Exception e) {
        log.error("GeminiService breakdownTask ë‚´ë¶€ ì˜¤ë¥˜", e);
        throw new RuntimeException("ì‘ì—… ë¶„í•´ ì‹¤íŒ¨", e);
    }
}
